app            = "accesslens"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile"

[env]
  ASPNETCORE_URLS          = "http://+:8080"
  SKIP_PLAYWRIGHT_INSTALL  = "1"
  MINIO_ROOT_USER          = "minioadmin"
  MINIO_ROOT_PASSWORD      = "<set-via-fly-secrets>"
  SQLITE_CONNECTION_STRING = "Data Source=/data/accesslens.db"

[processes]
  app = "/entrypoint.sh"

[[services]]
  processes     = ["app"]
  internal_port = 8080
  protocol      = "tcp"

  [[services.ports]]
    handlers = ["http"]
    port     = 80

  [[services.ports]]
    handlers = ["tls", "http"]
    port     = 443

  # Expose MinIO S3 API internally (no handlers by default)
  [[services.ports]]
    processes = ["app"]
    port = 9000

  [[services.http_checks]]
    processes = ["app"]
    port      = 80
    method    = "get"
    path      = "/api/health"
    interval  = "30s"
    timeout   = "5s"

[[mounts]]
  source      = "data"
  destination = "/data"