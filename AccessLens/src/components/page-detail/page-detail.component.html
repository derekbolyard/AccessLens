<div class="page-detail">
  <div class="container">
    <!-- Enhanced Breadcrumb Navigation -->
    <app-breadcrumb 
      [items]="breadcrumbItems"
    ></app-breadcrumb>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <app-loading type="skeleton" [skeletonLines]="4" text="Loading page details..."></app-loading>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !page" class="empty-state">
      <app-card [elevated]="true" class="empty-state-card">
        <div class="empty-state-content">
          <div class="empty-state-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
          </div>
          <h3>Page Not Found</h3>
          <p>The page you're looking for doesn't exist or may have been removed.</p>
          <button class="back-to-pages-btn" (click)="onBackToPages()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15,18 9,12 15,6"/>
            </svg>
            Back to Pages
          </button>
        </div>
      </app-card>
    </div>

    <!-- Page Content -->
    <div *ngIf="!isLoading && page">
      <!-- Enhanced Page Context -->
      <app-page-context 
        [context]="{
          title: page.title || 'Page Issues',
          subtitle: page.url,
          icon: 'page',
          stats: [
            { label: 'Score', value: (page.score || 0) + '%', variant: (page.score || 0) >= 80 ? 'success' : 'warning' },
            { label: 'Pending', value: getPendingIssues().length, variant: 'error' },
            { label: 'Fixed', value: page.fixedIssues, variant: 'success' },
            { label: 'Ignored', value: page.ignoredIssues, variant: 'default' }
          ]
        }"
      ></app-page-context>

      <!-- Success/Error Alerts -->
      <app-alert 
        *ngIf="updateSuccess" 
        variant="success" 
        [dismissible]="true"
        (dismiss)="updateSuccess = ''"
      >
        {{ updateSuccess }}
      </app-alert>

      <app-alert 
        *ngIf="updateError" 
        variant="error" 
        [dismissible]="true"
        (dismiss)="updateError = ''"
      >
        {{ updateError }}
      </app-alert>

      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button 
          class="filter-tab"
          [class.active]="activeFilter === 'all'"
          (click)="setFilter('all')"
        >
          All Issues ({{ page.issues.length }})
        </button>
        <button 
          class="filter-tab"
          [class.active]="activeFilter === 'pending'"
          (click)="setFilter('pending')"
        >
          Pending ({{ getPendingIssues().length }})
        </button>
        <button 
          class="filter-tab"
          [class.active]="activeFilter === 'fixed'"
          (click)="setFilter('fixed')"
        >
          Fixed ({{ page.fixedIssues }})
        </button>
        <button 
          class="filter-tab"
          [class.active]="activeFilter === 'ignored'"
          (click)="setFilter('ignored')"
        >
          Ignored ({{ page.ignoredIssues }})
        </button>
      </div>

      <!-- Empty Issues State -->
      <div *ngIf="getFilteredIssues().length === 0" class="empty-issues-state">
        <app-card [elevated]="true" class="empty-issues-card">
          <div class="empty-issues-content">
            <div class="empty-issues-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <polyline points="20,6 9,17 4,12"/>
              </svg>
            </div>
            <h4>No {{ activeFilter === 'all' ? '' : activeFilter }} Issues Found</h4>
            <p *ngIf="activeFilter === 'all'">This page has no accessibility issues. Great job!</p>
            <p *ngIf="activeFilter !== 'all'">No {{ activeFilter }} issues to display.</p>
          </div>
        </app-card>
      </div>

      <!-- Issues List -->
      <div *ngIf="getFilteredIssues().length > 0" class="issues-section">
        <div class="issues-list">
          <div 
            *ngFor="let issue of getFilteredIssues(); trackBy: trackByIssueId"
            class="issue-card card fade-in"
            [class.updating]="isUpdating(issue.id)"
          >
            <div class="issue-header">
              <div class="issue-type">
                <span class="type-badge" [class]="'badge-' + issue.type">
                  {{ getTypeLabel(issue.type) }}
                </span>
                <span class="impact-badge badge" [class]="'badge-' + getImpactColor(issue.impact)">
                  {{ issue.impact }}
                </span>
              </div>
              <div class="issue-status">
                <span class="status-badge badge" [class]="'badge-' + getStatusColor(issue.status)">
                  {{ getStatusLabel(issue.status) }}
                </span>
              </div>
            </div>

            <div class="issue-content">
              <h3 class="issue-title">{{ issue.description }}</h3>
              <div class="issue-rule">
                <strong>Rule:</strong> {{ issue.rule }}
              </div>
              <div class="issue-element">
                <strong>Element:</strong>
                <code>{{ issue.element }}</code>
              </div>
              <div class="issue-help">
                <p>{{ issue.help }}</p>
                <a [href]="issue.helpUrl" target="_blank" rel="noopener noreferrer" class="help-link">
                  Learn more about this rule
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15,3 21,3 21,9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                  </svg>
                </a>
              </div>
            </div>

            <div class="issue-actions">
              <button 
                class="btn btn-success btn-sm"
                [class.active]="issue.status === 'fixed'"
                [disabled]="isUpdating(issue.id)"
                (click)="updateIssueStatus(issue.id, 'fixed')"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20,6 9,17 4,12"/>
                </svg>
                {{ isUpdating(issue.id) ? 'Updating...' : 'Mark Fixed' }}
              </button>
              <button 
                class="btn btn-secondary btn-sm"
                [class.active]="issue.status === 'ignored'"
                [disabled]="isUpdating(issue.id)"
                (click)="updateIssueStatus(issue.id, 'ignored')"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="m9 12 2 2 4-4"/>
                </svg>
                {{ isUpdating(issue.id) ? 'Updating...' : 'Ignore' }}
              </button>
              <button 
                class="btn btn-error btn-sm"
                [class.active]="issue.status === 'open'"
                [disabled]="isUpdating(issue.id)"
                (click)="updateIssueStatus(issue.id, 'open')"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="15" y1="9" x2="9" y2="15"/>
                  <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                {{ isUpdating(issue.id) ? 'Updating...' : 'Not Fixed' }}
              </button>
              <button 
                class="btn btn-info btn-sm"
                [class.active]="issue.status === 'open'"
                [disabled]="isUpdating(issue.id)"
                (click)="updateIssueStatus(issue.id, 'open')"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2v20m10-10H2"/>
                </svg>
                {{ isUpdating(issue.id) ? 'Updating...' : 'Reopen' }}
              </button>
            </div>

            <!-- Loading overlay for updating issues -->
            <div *ngIf="isUpdating(issue.id)" class="updating-overlay">
              <div class="updating-spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>